<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>公路客運票價試算</title>
</head>
<body>
<script type="text/javascript">
//除法函數，用來得到精確的除法結果
// 說明：javascript的除法結果會有誤差，在兩個浮點數相除的時候會比較明顯。這個函數返回較為精確的除法結果。
//調用：accDiv(arg1,arg2)
//返回值：arg1除以arg2的精確結果
function accDiv(arg1, arg2) {
         var t1 = 0, t2 = 0, r1, r2;
         try { t1 = arg1.toString().split(".")[1].length } catch (e) { }
         try { t2 = arg2.toString().split(".")[1].length } catch (e) { }
         with (Math) {
             r1 = Number(arg1.toString().replace(".", ""))
             r2 = Number(arg2.toString().replace(".", ""))
             return (r1 / r2) * pow(10, t2 - t1);
         }
     }

//給Number類型增加一個div方法，調用起來更加方便。
Number.prototype.div = function(arg) {
         return accDiv(this, arg);
     }

//乘法函數，用來得到精確的乘法結果
//說明：javascript的乘法結果會有誤差，在兩個浮點數相乘的時候會比較明顯。這個函數返回較為精確的乘法結果。
//調用：accMul(arg1,arg2)
//返回值：arg1乘以 arg2的精確結果
function accMul(arg1, arg2) {
         var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
         try { m += s1.split(".")[1].length } catch (e) { }
         try { m += s2.split(".")[1].length } catch (e) { }
         return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)
     }

// 給Number類型增加一個mul方法，調用起來更加方便。
Number.prototype.mul = function(arg) {
         return accMul(arg, this);
     }

//加法函數，用來得到精確的加法結果
//說明：javascript的加法結果會有誤差，在兩個浮點數相加的時候會比較明顯。這個函數返回較為精確的加法結果。
//調用：accAdd(arg1,arg2)
// 返回值：arg1加上arg2的精確結果
function accAdd(arg1, arg2) {
         var r1, r2, m, c;
         try { r1 = arg1.toString().split(".")[1].length } catch (e) { r1 = 0 }
         try { r2 = arg2.toString().split(".")[1].length } catch (e) { r2 = 0 }
         c = Math.abs(r1 - r2);
         m = Math.pow(10, Math.max(r1, r2))
         if (c > 0) {
             var cm = Math.pow(10, c);
             if (r1 > r2) {
                 arg1 = Number(arg1.toString().replace(".", ""));
                 arg2 = Number(arg2.toString().replace(".", "")) * cm;
             }
             else {
                 arg1 = Number(arg1.toString().replace(".", "")) * cm;
                 arg2 = Number(arg2.toString().replace(".", ""));
             }
         }
         else {
             arg1 = Number(arg1.toString().replace(".", ""));
             arg2 = Number(arg2.toString().replace(".", ""));
         }
         return (arg1 + arg2) / m
     }

//給Number類型增加一個add方法，調用起來更加方便。
Number.prototype.add = function(arg) {
         return accAdd(arg, this);
     }
//減法函數，用來得到精確的減法結果
//說明：javascript的減法結果會有誤差，在兩個浮點數相減的時候會比較明顯。這個函數返回較為精確的減法結果。
//調用：accSub(arg1,arg2)
// 返回值：arg1加上arg2的精確結果
function accSub(arg1,arg2){
　　 var r1,r2,m,n;
　　 try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
　　 try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
　　 m=Math.pow(10,Math.max(r1,r2));
　　 //last modify by deeka
　　 //動態控制精度長度
　　 n=(r1>=r2)?r1:r2;
　　 return ((arg1*m-arg2*m)/m).toFixed(n);
}
Number.prototype.sub = function(arg) {
         return accSub(arg, this);
     }

	var fare_per_km = 2.989;
	var fare_per_km_old = 3.068;
	var fare_per_km_card = 2.623;
	var interval_name = ["臺南","仁德","歸仁","關廟","花園","龍崎","中坑","龍船","苦苓湖","烏山頭","內東里","中埔","旗山","溪洲","尚和","嶺口","佛光山"];
	var interval_dis = [8.5,5.2,3.0,1.2,3.1,3.1,1.4,2.8,3.2,4.0,3.1,9.0,5.6,3.3,4.8,3.1];
	var base_dis = 8;
	var base_cash = Math.round(base_dis.mul(fare_per_km.mul(1.05)));
	var base_cash_old = Math.round(base_dis.mul(fare_per_km_old.mul(1.05)));
	var base_cash_card = Math.round(base_dis.mul(fare_per_km_card.mul(1.05)));
	var d_arr = [];
	//document.write('<table border="1">');
	for(i=0;i<interval_name.length;++i){
		d_arr[i] = [];
		document.write('[');
		//document.write('<tr>');
		var sum = 0;
		for(j=0;j<interval_name.length;++j){
			//document.write('<td>');
			if(i==j){
				//document.write(interval_name[j]);
				document.write(base_cash);
				d_arr[i][j-i] = sum;
			}
			else if(i<j){
				sum = sum.add(interval_dis[j-1]);
				raw_cash = Math.round(sum.mul(fare_per_km_old.mul(1.05)));
				//document.write(i+','+j+'=');
				//document.write( raw_cash<base_cash_old?base_cash_old:raw_cash );
				d_arr[i][j-i] = sum;
				//document.write(d_arr[i][j-i]);
				raw_cash = Math.round(d_arr[i][j-i].mul(fare_per_km_card.mul(1.05)));
				document.write(',');
				document.write( (raw_cash<base_cash_card)?base_cash_card:raw_cash );
			}
			else{
				raw_cash = Math.round(d_arr[j][i-j].mul(fare_per_km.mul(1.05)));
				//document.write(j+','+(i-j)+'='+d_arr[j][i-j]);
				document.write( (raw_cash<base_cash)?base_cash:raw_cash );
				document.write(',');
			}
			//document.write('</td>');
		}
			document.write('],<br />');
		//document.write('</tr>');
	}
	//document.write('</table>');
	//document.write(d_arr);
</script>
</body>
</html>