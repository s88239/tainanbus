<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>公路客運票價試算 反向</title>
</head>
<body>
<script type="text/javascript">
//除法函數，用來得到精確的除法結果
// 說明：javascript的除法結果會有誤差，在兩個浮點數相除的時候會比較明顯。這個函數返回較為精確的除法結果。
//調用：accDiv(arg1,arg2)
//返回值：arg1除以arg2的精確結果
function accDiv(arg1, arg2) {
         var t1 = 0, t2 = 0, r1, r2;
         try { t1 = arg1.toString().split(".")[1].length } catch (e) { }
         try { t2 = arg2.toString().split(".")[1].length } catch (e) { }
         with (Math) {
             r1 = Number(arg1.toString().replace(".", ""))
             r2 = Number(arg2.toString().replace(".", ""))
             return (r1 / r2) * pow(10, t2 - t1);
         }
     }

//給Number類型增加一個div方法，調用起來更加方便。
Number.prototype.div = function(arg) {
         return accDiv(this, arg);
     }

//乘法函數，用來得到精確的乘法結果
//說明：javascript的乘法結果會有誤差，在兩個浮點數相乘的時候會比較明顯。這個函數返回較為精確的乘法結果。
//調用：accMul(arg1,arg2)
//返回值：arg1乘以 arg2的精確結果
function accMul(arg1, arg2) {
         var m = 0, s1 = arg1.toString(), s2 = arg2.toString();
         try { m += s1.split(".")[1].length } catch (e) { }
         try { m += s2.split(".")[1].length } catch (e) { }
         return Number(s1.replace(".", "")) * Number(s2.replace(".", "")) / Math.pow(10, m)
     }

// 給Number類型增加一個mul方法，調用起來更加方便。
Number.prototype.mul = function(arg) {
         return accMul(arg, this);
     }

//加法函數，用來得到精確的加法結果
//說明：javascript的加法結果會有誤差，在兩個浮點數相加的時候會比較明顯。這個函數返回較為精確的加法結果。
//調用：accAdd(arg1,arg2)
// 返回值：arg1加上arg2的精確結果
function accAdd(arg1, arg2) {
         var r1, r2, m, c;
         try { r1 = arg1.toString().split(".")[1].length } catch (e) { r1 = 0 }
         try { r2 = arg2.toString().split(".")[1].length } catch (e) { r2 = 0 }
         c = Math.abs(r1 - r2);
         m = Math.pow(10, Math.max(r1, r2))
         if (c > 0) {
             var cm = Math.pow(10, c);
             if (r1 > r2) {
                 arg1 = Number(arg1.toString().replace(".", ""));
                 arg2 = Number(arg2.toString().replace(".", "")) * cm;
             }
             else {
                 arg1 = Number(arg1.toString().replace(".", "")) * cm;
                 arg2 = Number(arg2.toString().replace(".", ""));
             }
         }
         else {
             arg1 = Number(arg1.toString().replace(".", ""));
             arg2 = Number(arg2.toString().replace(".", ""));
         }
         return (arg1 + arg2) / m
     }

//給Number類型增加一個add方法，調用起來更加方便。
Number.prototype.add = function(arg) {
         return accAdd(arg, this);
     }
//減法函數，用來得到精確的減法結果
//說明：javascript的減法結果會有誤差，在兩個浮點數相減的時候會比較明顯。這個函數返回較為精確的減法結果。
//調用：accSub(arg1,arg2)
// 返回值：arg1加上arg2的精確結果
function accSub(arg1,arg2){
　　 var r1,r2,m,n;
　　 try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
　　 try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
　　 m=Math.pow(10,Math.max(r1,r2));
　　 //last modify by deeka
　　 //動態控制精度長度
　　 n=(r1>=r2)?r1:r2;
　　 return ((arg1*m-arg2*m)/m).toFixed(n);
}
Number.prototype.sub = function(arg) {
         return accSub(arg, this);
     }

	var fare_per_km = 2.989;
	var fare_per_km_old = 3.068;
	var interval_name = ["南化","金馬寮","木柵","內門","中埔","旗山"];
	var interval_price = [
	[26,26,32,45,58,73],
	[26,26,26,26,37,52],
	[28,26,26,26,26,41],
	[41,26,26,26,26,28],
	[52,37,26,26,26,26],
	[73,58,45,32,26,26]
	];
	var interval_dis = [];
	var base_dis = 8;
	var base_cash = Math.round(base_dis.mul(fare_per_km.mul(1.05)));
	var base_cash_old = Math.round(base_dis.mul(fare_per_km_old.mul(1.05)));
	document.write('<table border="1">');
	for(i=0;i<interval_price.length;++i){
		interval_dis[i] = [];
		document.write('<tr>');
		//interval_dis[i] = interval_price[i+1][i];
		tmp_dis = 0;
		for(j=0;j<interval_price[i].length;++j){
			document.write('<td>');
			if(i==j) document.write(interval_name[j]);
			else if(interval_price[i][j]==base_cash_old){
				tmp_dis = 8;
				interval_dis[i].push( base_dis );
				document.write(base_dis);
			}
			else if(i>j){
				tmp_dis = interval_price[i][j].div(fare_per_km_old.mul(1.05)).toFixed(6);
				interval_dis[i].push( tmp_dis );
				document.write( tmp_dis );
			}
			else document.write(interval_price[i][j]);
			document.write('</td>');
		}
		document.write('</tr>');
	}
	document.write('</table><br />');
	document.write('<table border="1">');
	var accumulate = 0, acc_count=0;
	var card_fare_per_km = 2.623;
	/*for(i=0;i<interval_dis.length;++i){
		for(j=0;j<interval_dis[i].length;++j){
			document.write('('+i+','+j+')='+interval_dis[i][j] + ' ');
			//document.write(interval_dis[i][j]);
		}
		document.write('<br />')
	}*/
	for(i=0;i<interval_price.length;++i){
		document.write('<tr>');
		//interval_dis[i] = interval_price[i+1][i];
		//accumulate_row = 0;
		//row_count = 0;
		for(j=0;j<interval_price[i].length;++j){
			document.write('<td>');
			if(i==j) document.write(interval_name[j]);
			else if(i<j){
				document.write( Math.round( accMul(interval_dis[j][i],accMul(card_fare_per_km,1.05) ) ) );
				//tmp_dis = interval_dis[j][i];
				//interval_price[i][j].div(interval_dis[j][i].mul(1.05)).toFixed(1);
				//interval_dis[i].push( tmp_dis );
				/*document.write(accDiv(interval_price[i][j], accMul(tmp_dis,1.05) ));
				if(	interval_price[i][j]==22) continue;
				++row_count;
				accumulate_row = accAdd(accumulate_row, accDiv(interval_price[i][j], accMul(tmp_dis,1.05) ) );
				++acc_count;
				accumulate = accAdd(accumulate, accDiv(interval_price[i][j], accMul(tmp_dis,1.05) ) );*/
			}
			else{
				document.write( Math.round( accMul(interval_dis[i][j],accMul(fare_per_km,1.05) ) ) );
			}
			document.write('</td>');
		}
		//tmp_row = accDiv(accumulate_row,row_count);
		document.write('</tr>');//<br />aver_fare_ration='+tmp_row);
		//if()
	}
		//tmp = accDiv(accumulate,acc_count);
	document.write('</table>');//<br />aver_fare_ration='+tmp);
</script>
</body>
</html>